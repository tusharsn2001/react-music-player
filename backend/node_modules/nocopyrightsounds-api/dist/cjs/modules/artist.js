'use strict'
var __importDefault =
    (this && this.__importDefault) ||
    function (mod) {
        return mod && mod.__esModule ? mod : { default: mod }
    }
Object.defineProperty(exports, '__esModule', { value: true })
exports.getArtistInfo = void 0
const jsdom_1 = require('jsdom')
const axios_1 = __importDefault(require('axios'))
const parseTable_1 = __importDefault(require('../helpers/parseTable'))
const getArtistInfo = async (artistUrl) => {
    if (typeof artistUrl != 'string') artistUrl = artistUrl.url
    const { data: html } = await axios_1.default.get(`https://ncs.io${artistUrl}`, {
        responseType: 'text'
    })
    const dom = new jsdom_1.JSDOM(html)
    const document = dom.window.document.body
    const infoEl = document.querySelector('.details .info')
    const name = infoEl.querySelector('h5').innerHTML
    const genres = infoEl.querySelector('.tags').innerHTML.split(', ')
    const img = document
        .querySelector('.img')
        ?.getAttribute('style')
        ?.trim()
        ?.replace("background-image: url('", '')
        ?.replace("')", '')
    const fearuredEl = document.querySelector('.featured tbody')
    const featured = !fearuredEl ? [] : (0, parseTable_1.default)(fearuredEl)
    const songsEl = fearuredEl
        ? document.querySelectorAll('.table tbody')[1]
        : document.querySelector('.table tbody')
    const songs = (0, parseTable_1.default)(songsEl)
    return {
        name,
        url: artistUrl,
        img,
        genres,
        featured,
        songs
    }
}
exports.getArtistInfo = getArtistInfo
